{{ define "settings" }}
<div id="settings">
    <div class="list el-row">
        <div class="el-col el-col-6">
            <i class="el-icon-s-custom"></i>
            上传头像:
        </div>
        <div class="el-col el-col-18">
            <input class="photo" name="image" type="file">
        </div>
    </div>
    <div class="list" style="text-align: center;">
        <input type="button" id="modifyPhoto" class="el-button el-button--primary" value="更新头像" />
    </div>

    <div class="list el-row">
        <div class="el-col el-col-6">
            <i class="el-icon-phone"></i>
            修改电话:
        </div>
        <div class="el-col el-col-18">
            <input class="phone" type="text" placeholder="请输入要修改的电话">
        </div>
    </div>
    <div class="list el-row">
        <div class="el-col el-col-6">
            <i class="el-icon-receiving"></i>
            修改邮箱:
        </div>
        <div class="el-col el-col-18">
            <input class="email" type="text" placeholder="请输入要修改的邮箱">
        </div>
    </div>
    <div class="list" style="text-align: center;">
        <button id="modifyUser" type="button" class="el-button el-button--primary" size="mini">
            更新
        </button>
        <button id="returnHome" type="button" class="el-button el-button--default" size="mini">
            返回
        </button>
    </div>
    <div role="alert" class="el-alert el-alert--success is-dark settings-success" style="display: none;">
        <div class="el-alert__content">
            <span class="el-alert__title">成功提示的文案</span>
            <i class="el-alert__closebtn el-icon-close"></i>
        </div>
    </div>
    <div role="alert" class="el-alert el-alert--error is-dark settings-error" style="display: none;">
        <div class="el-alert__content">
            <span class="el-alert__title">错误提示的文案</span>
            <i class="el-alert__closebtn el-icon-close"></i>
        </div>
    </div>
</div>
<script>
    $("#modifyUser").click(function () {
        var phone = $(".phone").val()
        var email = $(".email").val()
        $.ajax({
            type: "POST",
            url: '/in/api/usermod',
            contentType: 'application/json',
            data: JSON.stringify({
                "phone": phone,
                "email": email
            }),
            headers: {
                "Authorization": $.cookie("Authorization")
            },
            success: function (data) {
                var Msg = "更新用户信息成功"
                $(".settings-success span").html(Msg)
                $(".settings-success").fadeIn()
                setTimeout(function () {
                    location.reload(0)
                }, 1000)
            },
            error: function (data) {
                var Msg = "更新用户信息失败"
                $(".settings-error span").html(Msg)
                $(".settings-error").fadeIn()
            }
        })
    })
    $("#modifyPhoto").click(function () {
        var file = $(".photo").prop("files")
        if (file[0] != undefined) {
            var fileName = file[0]["name"]
            $("#fileName").html(fileName)
            if (fileName.indexOf(".jpg") == -1 && fileName.indexOf(".png") == -1) {
                var errMsg = "上传图片只能是 jpg 或 png 格式"
                $(".settings-error span").html(errMsg)
                $(".settings-error").fadeIn()
            } else {
                var formData = new FormData();
                formData.append("image", $(".photo")[0].files[0]);
                $.ajax({
                    url: '/in/api/usermodphoto',
                    data: formData,
                    type: "post",
                    dataType: 'json',
                    cache: false,
                    contentType: false,
                    processData: false,
                    headers: {
                        "Authorization": $.cookie("Authorization")
                    },
                    success: function (data) {
                        var Msg = "更新头像成功"
                        $(".settings-success span").html(Msg)
                        $(".settings-success").fadeIn()
                        setTimeout(function () {
                            location.reload(0)
                        }, 1000)
                    },
                })
            }
        } else {
            var errMsg = "没有选择有上传的文件"
            $(".settings-error span").html(errMsg)
            $(".settings-error").fadeIn()
        }

    })
    $(".el-icon-close").click(function () {
        $(this).parent().parent().fadeOut()
    })
    $("#returnHome").click(function () {
        $("#settings").fadeOut()
    })
</script>
{{ end }}